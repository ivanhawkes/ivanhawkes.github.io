<!doctype html><html>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=apple-touch-icon href=/img/apple-icon.png>
<link rel=icon href=/img/favicon.png>
<title>Life Reboot</title>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="CryEngine 3 - Flowgraph Events">
<meta name=twitter:description content="As you begin to learn how to program for CryEngine 3 you will run into a lot of barriers. The code is dense, filled with magic numbers, brimming with pre-processor code, macros, and templates and all sorts of traps.">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
<div class=container-fluid>
<a class=navbar-brand href=https://ivanhawkes.github.io>Ivan Hawkes</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class=nav-item>
<a href=https://ivanhawkes.github.iopost class="nav-link d-flex align-items-center">
<i class=bi-stickies></i>&#160;Posts
</a>
</li>
<li class=nav-item>
<a href=https://ivanhawkes.github.ioproject class="nav-link d-flex align-items-center">
<i class=bi-kanban></i>&#160;Our Projects
</a>
</li>
<li class=nav-item>
<a href=https://ivanhawkes.github.ioprofile class="nav-link d-flex align-items-center">
<i class=bi-file-earmark-person></i>&#160;Our Team
</a>
</li>
<li class=nav-item>
<a href=https://ivanhawkes.github.iorecipe class="nav-link d-flex align-items-center">
<i class=bi-egg-fried></i>&#160;Recipes
</a>
</li>
<li class=nav-item>
<a href=https://ivanhawkes.github.iogarden class="nav-link d-flex align-items-center">
<i class=bi-tree></i>&#160;Garden
</a>
</li>
<li class=nav-item>
<a href=https://ivanhawkes.github.ioplant class="nav-link d-flex align-items-center">
<i class=bi-flower1></i>&#160;Plants
</a>
</li>
<li class=nav-item>
<a href=https://ivanhawkes.github.ioabout class="nav-link d-flex align-items-center">
<i class=bi-person-lines-fill></i>&#160;About Us
</a>
</li>
</ul>
</div>
</div>
</nav>
<div class=container>
<div class=container>
<div class=row>
<div class="col text-center">
<h1>CryEngine 3 - Flowgraph Events</h1>
<div class=card>
<div class="card-header card-header-image">
<a href=#pablo>
<img src=/img/site/category/cryengine.jpg class=card-img-top alt>
</a>
<div class=colored-shadow style=background-image:url(/img/site/category/cryengine.jpg);opacity:1></div>
</div>
<div class=card-body>
<p class=text-start></p>
</div>
</div>
</div>
</div>
<div class=row>
<div class=col-12>
<hr>
</div>
</div>
<div class=row>
<div class=col-6>
<p class=h6>
By Ivan Hawkes<br>June 27, 2013
</p>
</div>
<div class="col-6 text-end">
<a href="https://www.facebook.com/sharer/sharer.php?u=ivan.hawkes" class=btn target=_blank>
<i class=bi-facebook style=font-size:32px></i>
</a>
<a href="https://twitter.com/intent/tweet?url=%40ivanhawkes" class=btn target=_blank>
<i class=bi-twitter style=font-size:32px></i>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=ivan-hawkes-a8386338" class=btn target=_blank>
<i class=bi-linkedin style=font-size:32px></i></a>
<a href="http://www.pinterest.com/pin/find/?url=ivanhawkes" class=btn target=_blank>
<i class=bi-pinterest style=font-size:32px></i></a>
</div>
</div>
<div class=row>
<div class=col-12>
<hr>
</div>
</div>
<div class=row>
<div class=col>
<p>As you begin to learn how to program for CryEngine 3 you will run into a lot of barriers. The code is dense, filled with magic numbers, brimming with pre-processor code, macros, and templates and all sorts of traps.</p>
<p>My only advice for this is to bear down and work through it. In time they will all start to make sense.</p>
<p>I&rsquo;m currently working on producing my first few pieces of code that will provide a few useful features for the engine. I&rsquo;m attempting to add a feeling of time and change in the form of days, seasons, tides and time of day parameters that are dynamic based on the current time of year. It&rsquo;s a fairly small set of additions but they should help to increase the dynamic feel of the world for the players.</p>
<p>In order to do this I will need to make a few additions to the code base. I&rsquo;m choosing to do this using a slightly modified version of the <a href=https://github.com/hendrikp/Plugin_SDK title="plug-in engine">plug-in engine</a> from <a href=https://github.com/hendrikp title=Hendrik>Hendrik</a>. The changes I made are very minor, and mainly play into my OCD need for everything to be &lsquo;just so&rsquo;.</p>
<p>The first stop is creating a new set of flowgraph nodes that will help implement the desired changes. Helpfully, the <a href=https://github.com/hendrikp/Plugin_SDK title="plug-in SDK">plug-in SDK</a> provides a template of your project with the major functionality already implemented. There is also a <a href=https://bitbucket.org/shatteredscreens/plug-in-sdk title="plug-in SDK">fork of this project</a> which I have created which adds a few little tweaks and improvements. You can use either to follow along as all the changes are minor tweaks for now.</p>
<p>The first wall you are going to hit when you attempt to create your own new flowgraph nodes if the event handling. It&rsquo;s not very well documented and although fairly intuitive has a few little gotchas laying in wait. Let&rsquo;s start by listing all the known event types and a brief description of what they do (as known at time of writing).</p>
<h1 id=event-types>Event Types</h1>
<p><strong>eFE_Update</strong></p>
<p>This event is called when the node is updated. Typically this is for each game frame while it is in use. You must tell the System that you want your node to be updated by using the SetRegularlyUpdated function of the IFlowGraph object and passing in TRUE. You can also tell it not to update the node by calling SetRegularlyUpdated and passing in FALSE.</p>
<p>If you have a handler for eFE_Suspend it should call this with FALSE. A handler for eFE_Resume should call this with TRUE.</p>
<p><strong>eFE_Activate</strong></p>
<p>If one or more input ports have been activated then you will receive this event. You will need to make a call on each port of interest and determine which (of possibly many) have been called. This is the heart of the processing system.</p>
<p>This will typically be called once per event. It may find multiple ports are open with each invocation. You should check each in turn and process accordingly.</p>
<p><strong>eFE_FinalActivate</strong></p>
<p>This will be called once after all the eFE_Activate events have been pushed out.</p>
<p><strong>eFE_PrecacheResources</strong></p>
<p>This is called after flow graph loading to allow you to precache resources inside flow nodes. I have seen it after initialisation has been completed and prior to processing beginning.</p>
<p><strong>eFE_Initialize</strong></p>
<p>Initialise can be sent at several different times. If you make changes to the node it might require a new initialise call e.g. changing the use of input / output ports.</p>
<p><strong>eFE_FinalInitialize</strong></p>
<p>Potentially called at the end of all initialise calls, but it may not always be called (observed).</p>
<p><strong>eFE_SetEntityId</strong></p>
<p>This event is sent to set the entity of the FlowNode. It might also be sent in conjunction (pre) other events (like eFE_Initialize). Generally you will use this as a chance to make a member copy of the entity ID for later usage.</p>
<p><strong>eFE_Suspend</strong></p>
<p>Indications are that nodes can be suspended and resumed, though I have not yet determined when and why. Currently I execute</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>pActInfo<span style=color:#f92672>-&gt;</span>pGraph<span style=color:#f92672>-&gt;</span>SetRegularlyUpdated (pActInfo<span style=color:#f92672>-&gt;</span>myID, false);
</code></pre></div><p>in response to this event.</p>
<p><strong>eFE_Resume</strong></p>
<p>Used to come back out of suspension. If you used &lsquo;SetRegularlyUpdated&rsquo; to sleep the node then you might need to reverse this operation now.</p>
<p>Currently I execute</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>pActInfo<span style=color:#f92672>-&gt;</span>pGraph<span style=color:#f92672>-&gt;</span>SetRegularlyUpdated (pActInfo<span style=color:#f92672>-&gt;</span>myID, true);
</code></pre></div><p><strong>eFE_ConnectInputPort</strong></p>
<p>This is called once an input port is connected to the node. At the end of connecting and disconnecting all the ports an initialise is called.</p>
<p><strong>eFE_DisconnectInputPort</strong></p>
<p>This is called once an input port is disconnected from the node. At the end of connecting and disconnecting all the ports an initialise is called.</p>
<p><strong>eFE_ConnectOutputPort</strong></p>
<p>This is called once an output port is connected to the node. At the end of connecting and disconnecting all the ports an initialise is called.</p>
<p><strong>eFE_DisconnectOutputPort</strong></p>
<p>This is called once an output port is disconnected from the node. At the end of connecting and disconnecting all the ports an initialise is called.</p>
<h2 id=the-event-cycle>The Event Cycle</h2>
<p>On starting the editor, if you have any flowgraphs that are global you can expect a series of &lsquo;connect&rsquo; and &lsquo;disconnect&rsquo; events to fire off. Once those have completed an &lsquo;initialise&rsquo; is fired followed by a &lsquo;precache&rsquo;. This should repeat if you then load a level into the editor.</p>
<p>Once you begin testing the level the flowgraph nodes will respond to any events that you have wired to them.</p>
<p>Presently there seems little reason to respond to connect events.</p>
<p>The suspend and resume events seems mostly concerned with setting the node into a low power state. If you do this then be sure to also push it into a wakeful state on initialise.</p>
<p>The pre-cache event is only used once in the sample code for a colour gradient. It appears to load the appropriate colour into a texture resource, ready for use when called.</p>
<h2 id=future-additions>Future Additions</h2>
<p>This article is incomplete at present, more a place to collect my thoughts as I work through the code. Look for updates at a later time.</p>
</div>
</div>
<div class=row>
<div class=col-12>
<hr>
</div>
</div>
<div class=row>
<div class=col>
<p class=h6>
Discover more posts like this:
</p>
<p class=h6>
<a class="btn btn-primary" href=/tags/c>
C#
</a>
<a class="btn btn-primary" href=/tags/cryengine-3>
CryEngine 3
</a>
<a class="btn btn-primary" href=/tags/events>
Events
</a>
<a class="btn btn-primary" href=/tags/flowgraph>
FlowGraph
</a>
<a class="btn btn-primary" href=/tags/programming>
Programming
</a>
</p>
</div>
</div>
<div class=row>
<div class=col>
<hr>
</div>
</div>
<div class=row>
<div class="col-6 text-start">
Previous:<br><a href=https://ivanhawkes.github.io/post/dealing-with-the-difficulty/> Dealing With The Difficulty</a>
</div>
<div class="col-6 text-end">
Next:<br><a href=https://ivanhawkes.github.io/post/building-a-cheap-motion-capture-studio/> Building A Cheap Motion Capture Studio</a>
</div>
</div>
</div>
</div>
<footer>
<div class=row>
<div class=col>
<hr>
</div>
</div>
<nav class="navbar navbar-expand-lg">
<div class=container-fluid>
&copy; 2021 Ivan Hawkes all rights reserved.
</div>
</nav>
</footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css integrity=sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3 crossorigin=anonymous>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js integrity=sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.0/font/bootstrap-icons.css integrity=sha384-7ynz3n3tAGNUYFZD3cWe5PDcE36xj85vyFkawcF6tIwxvIecqKvfwLiaFdizhPpN crossorigin=anonymous>
<link rel=stylesheet type=text/css href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons">
</body>
</html>